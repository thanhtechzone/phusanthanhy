<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ph√≤ng Kh√°m S·∫£n Ph·ª• Khoa Th√†nh √ù - L·ªãch Kh√°m</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .glass{background:rgba(255,255,255,0.6);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);}
    .badge{padding:2px 10px;border-radius:999px;font-size:12px;border:1px solid transparent}
  </style>
  <script>
    const weekdayLabels = ['Ch·ªß nh·∫≠t','Th·ª© 2','Th·ª© 3','Th·ª© 4','Th·ª© 5','Th·ª© 6','Th·ª© 7'];
    function getWeekDatesMondayFirst(){
      const today = new Date();
      const jsDay = today.getDay();
      const indexFromMonday = (jsDay + 6) % 7;
      const monday = new Date(today);
      monday.setDate(today.getDate() - indexFromMonday);
      const arr = [];
      for(let i=0;i<7;i++){ const d = new Date(monday); d.setDate(monday.getDate()+i); arr.push(d); }
      return arr;
    }
    function fmtDate(d){
      const dd = String(d.getDate()).padStart(2,'0');
      const mm = String(d.getMonth()+1).padStart(2,'0');
      return `${dd}/${mm}`;
    }
    function setWeekRange(){
      const ds = getWeekDatesMondayFirst();
      const range = `${fmtDate(ds[0])} - ${fmtDate(ds[6])}`;
      const el = document.getElementById('weekRange');
      if(el) el.textContent = `‚Äî tu·∫ßn ${range}`;
    }
    async function loadSchedule(){
	  const res = await fetch('/api/schedule');
	  const data = await res.json();
	  const byDay = Array.from({length:7},()=>[]);
	  data.forEach(s=>{byDay[s.weekday].push(s)});
	  const grid = document.getElementById('grid'); grid.innerHTML = '';
	  const weekOrder = [1,2,3,4,5,6,0];
	  const weekDates = getWeekDatesMondayFirst();

	  for(const d of weekOrder){
		const dayEl = document.createElement('div');
		dayEl.className='glass rounded-xl shadow border border-white/40 overflow-hidden backdrop-saturate-150 animate-[fadeIn_0.4s_ease]';
		const offset = d===0 ? 6 : d-1;
		const dateStr = fmtDate(weekDates[offset]);
		const slots = byDay[d] || [];

		// NEW: x√°c ƒë·ªãnh c√≥ ƒë√≥ng c·∫£ ng√†y kh√¥ng
		const allDayClosed = slots.some(s=>s.status==='CLOSED' && s.start==='00:00' && s.end==='23:59');
		const hasOpenSlot = slots.some(s=>s.status!=='CLOSED');

		// N·∫øu ƒë√≥ng c·∫£ ng√†y ‚Üí coi l√† ƒê√≥ng; ng∆∞·ª£c l·∫°i th√¨ M·ªü n·∫øu c√≥ √≠t nh·∫•t 1 slot m·ªü
		const isOpen = !allDayClosed && hasOpenSlot;
		const dayBadge = isOpen
		  ? '<span class="badge bg-cyan-50/80 text-cyan-700 border-cyan-200">M·ªü</span>'
		  : '<span class="badge bg-rose-50/80 text-rose-700 border-rose-200">ƒê√≥ng</span>';

		dayEl.innerHTML = `<div class="px-4 py-3 bg-white/60 border-b border-white/50 font-semibold flex items-center justify-between">
			<span>${weekdayLabels[d]} <span class="text-sm text-slate-600">${dateStr}</span></span>
			<span>${dayBadge}</span>
		  </div>`;

		if(slots.length===0){
		  const empty = document.createElement('div');
		  empty.className='px-4 py-6 text-sm text-slate-600';
		  empty.textContent = 'Kh√¥ng c√≥ l·ªãch';
		  dayEl.appendChild(empty);
		} else if(allDayClosed){
		  // NEW: hi·ªÉn th·ªã "Ph√≤ng kh√°m ngh·ªâ" thay v√¨ 00:00‚Äì23:59
		  const closeSlot = slots.find(s=>s.status==='CLOSED' && s.start==='00:00' && s.end==='23:59');
		  const note = closeSlot?.note ? ` (${closeSlot.note})` : '';
		  const closed = document.createElement('div');
		  closed.className = 'px-4 py-6 text-sm text-rose-700';
		  closed.innerHTML = `<strong>Ph√≤ng kh√°m ngh·ªâ</strong>${note}`;
		  dayEl.appendChild(closed);
		} else {
		  // Render c√°c slot b√¨nh th∆∞·ªùng, ·∫©n m·ªçi slot CLOSED l·∫ª t·∫ª n·∫øu c√≥
		  slots
			.filter(s=>s.status!=='CLOSED')
			.sort((a,b)=>a.start.localeCompare(b.start))
			.forEach(s=>{
			  const slot = document.createElement('div');
			  slot.className='px-4 py-3 border-b border-white/40 hover:bg-white/50 transition';
			  slot.innerHTML = `
				<div class="min-w-0">
				  <div class="font-semibold">${s.start} - ${s.end}</div>
				  ${s.note ? `<div class="text-xs text-slate-500 mt-1">Ghi ch√∫: ${s.note}</div>` : ''}
				</div>`;
			  dayEl.appendChild(slot);
			});

		  // N·∫øu sau khi l·ªçc kh√¥ng c√≤n slot m·ªü, v·∫´n hi·ªÉn th·ªã "Kh√¥ng c√≥ l·ªãch"
		  if(!slots.some(s=>s.status!=='CLOSED')){
			const empty = document.createElement('div');
			empty.className='px-4 py-6 text-sm text-slate-600';
			empty.textContent = 'Kh√¥ng c√≥ l·ªãch';
			dayEl.appendChild(empty);
		  }
		}

		grid.appendChild(dayEl);
	  }
	}
    window.addEventListener('DOMContentLoaded', ()=>{ setWeekRange(); loadSchedule(); });
  </script>
  <meta name="description" content="Ph√≤ng Kh√°m S·∫£n Ph·ª• Khoa Th√†nh √ù - L·ªãch kh√°m trong tu·∫ßn" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ü©∫</text></svg>">
 </head>
<body>
  <header class="sticky top-0 z-10 bg-gradient-to-r from-cyan-500 to-blue-600 text-white shadow">
    <div class="max-w-6xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-lg font-semibold tracking-wide">PH√íNG KH√ÅM S·∫¢N PH·ª§ KHOA TH√ÄNH √ù ‚Äî L·ªãch Kh√°m <span id="weekRange" class="font-normal text-white/90"></span></h1>
          <div class="text-white/90 text-sm mt-1">Th·∫°c sƒ© B√°c sƒ© n·ªôi tr√∫ Phan Th·ªã Minh √ù</div>
        </div>
        <a class="text-white/80 hover:text-white text-sm" href="/admin.html">Qu·∫£n tr·ªã</a>
      </div>
    </div>
  </header>
  <div class="relative min-h-screen bg-gradient-to-br from-slate-100 to-sky-100">
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_20%_20%,rgba(56,189,248,0.25),transparent_40%),radial-gradient(circle_at_80%_0%,rgba(14,165,233,0.25),transparent_35%)]"></div>
    <div class="relative max-w-6xl mx-auto px-4 py-6">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-7 gap-6" id="grid"></div>

      <div class="mt-8 glass rounded-xl border border-white/40 p-4">
        <div class="text-slate-700 font-semibold mb-2">K·∫øt n·ªëi v·ªõi ch√∫ng t√¥i</div>
        <div class="flex flex-wrap items-center gap-3 text-sm">
          <a class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-white/70 hover:bg-white transition border border-white/60" href="https://www.facebook.com/phusanthanhy" target="_blank" rel="noopener noreferrer">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40" width="18" height="18" fill="#1877F2" aria-label="Facebook">
              <path d="M13.651 35.471v-11.97H9.936V18h3.715v-2.37c0-6.127 2.772-8.964 8.784-8.964 1.138 0 3.103.223 3.91.446v4.983c-.425-.043-1.167-.065-2.081-.065-2.952 0-4.09 1.116-4.09 4.025V18h5.883l-1.008 5.5h-4.867v12.37a18.183 18.183 0 0 1-6.53-.399Z"></path>
            </svg>
            <span>Facebook</span>
          </a>
          <a class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-white/70 hover:bg-white transition border border-white/60" href="https://www.tiktok.com/@phusanthanhy" target="_blank" rel="noopener noreferrer">
            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 25 42" width="18" height="18" aria-label="TikTok"><g clip-path="url(#a)"><path fill="#25F4EE" d="M9.875 16.842v-1.119A9 9 0 0 0 8.7 15.64c-4.797-.006-8.7 3.9-8.7 8.708a8.7 8.7 0 0 0 3.718 7.134A8.68 8.68 0 0 1 1.38 25.55c0-4.737 3.794-8.598 8.495-8.707"></path><path fill="#25F4EE" d="M10.087 29.526c2.14 0 3.89-1.707 3.966-3.83l.007-18.968h3.462a7 7 0 0 1-.109-1.202h-4.727l-.006 18.969a3.98 3.98 0 0 1-3.967 3.829 3.9 3.9 0 0 1-1.846-.46 3.95 3.95 0 0 0 3.22 1.662m13.905-16.36v-1.055a6.5 6.5 0 0 1-3.584-1.068 6.57 6.57 0 0 0 3.584 2.123"></path><path fill="#FE2C55" d="M20.408 11.043a6.54 6.54 0 0 1-1.616-4.315h-1.265a6.56 6.56 0 0 0 2.881 4.315M8.707 20.365a3.98 3.98 0 0 0-3.974 3.976c0 1.528.87 2.858 2.134 3.523a3.94 3.94 0 0 1-.754-2.32 3.98 3.98 0 0 1 3.973-3.977c.41 0 .805.07 1.176.185V16.92a9 9 0 0 0-1.176-.083c-.07 0-.134.006-.204.006v3.708a4 4 0 0 0-1.175-.185"></path><path fill="#FE2C55" d="M23.992 13.166v3.676a11.25 11.25 0 0 1-6.579-2.116v9.622c0 4.8-3.903 8.713-8.706 8.713a8.67 8.67 0 0 1-4.99-1.579 8.7 8.7 0 0 0 6.37 2.781c4.797 0 8.706-3.906 8.706-8.714v-9.621a11.25 11.25 0 0 0 6.579 2.116v-4.73a6.5 6.5 0 0 1-1.38-.148"></path><path fill="#fff" d="M17.413 24.347v-9.621a11.25 11.25 0 0 0 6.58 2.116v-3.676a6.57 6.57 0 0 1-3.584-2.123 6.6 6.6 0  0 1-2.887-4.315h-3.463l-.006 18.968a3.98 3.98 0 0 1-3.967 3.83 3.99 3.99 0 0 1-3.225-1.656 3.99 3.99 0 0 1-2.134-3.523A3.98 3.98 0 0 1 8.7 20.371c.409 0 .805.07 1.176.185v-3.708c-4.702.103-8.496 3.964-8.496 8.701 0 2.289.888 4.373 2.338 5.933a8.67 8.67 0 0 0 4.989 1.58c4.797 0 8.706-3.913 8.706-8.715"></path></g><defs><clipPath id="a"><path fill="#000" d="M0 0h25v42H0z"></path></clipPath></defs></svg>
            <span>TikTok</span>
          </a>
          <a class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-white/70 hover:bg-white transition border border-white/60" href="https://zalo.me/2083712834905080546" target="_blank" rel="noopener noreferrer">
            <img src="https://i0.wp.com/help.zalo.me/wp-content/uploads/2023/08/cropped-hinhZalo-2.png?w=177&ssl=1" alt="Zalo" width="18" height="18" style="border-radius:4px" />
            <span>Zalo</span>
          </a>
        </div>
      </div>
    </div>
  </div>
  <footer class="text-slate-500 text-center py-6 text-sm">¬© <span id="year"></span> Ph√≤ng Kh√°m S·∫£n Ph·ª• Khoa Th√†nh √ù</footer>
  <script>document.getElementById('year').textContent=new Date().getFullYear()</script>
</body>
</html>


